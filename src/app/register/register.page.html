<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>
      <i class="fas fa-car"></i> Car Meet - Registro
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="register-container">
    <ion-card class="register-card">
      <ion-card-header>
        <ion-card-title class="text-center">
          <i class="fas fa-user-plus"></i>
          Crear Cuenta
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <!-- Foto de Perfil -->
        <div class="photo-upload-container">
          <div class="photo-wrapper" (click)="fileInput.click()">
            <img [src]="photoPreview || 'default/default-profile.webp'" alt="Foto de perfil" class="profile-photo">
            <div class="camera-icon-overlay">
              <ion-icon name="camera"></ion-icon>
            </div>
          </div>
          <input 
            #fileInput 
            type="file" 
            accept="image/*" 
            (change)="onPhotoSelected($event)" 
            style="display: none;">
          <p class="photo-hint">Toca para subir una foto</p>
        </div>

        <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
          <!-- Nombre -->
          <ion-item>
            <ion-label position="stacked">Nombre *</ion-label>
            <ion-input 
              type="text" 
              formControlName="firstName"
              placeholder="Ingresa tu nombre"
              [class.ion-invalid]="firstName?.invalid && firstName?.touched">
            </ion-input>
          </ion-item>
          <ion-text color="danger" *ngIf="firstName?.invalid && firstName?.touched">
            <small *ngIf="firstName?.errors?.['required']">El nombre es requerido</small>
            <small *ngIf="firstName?.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</small>
          </ion-text>

          <!-- Apellido -->
          <ion-item>
            <ion-label position="stacked">Apellido *</ion-label>
            <ion-input 
              type="text" 
              formControlName="lastName"
              placeholder="Ingresa tu apellido"
              [class.ion-invalid]="lastName?.invalid && lastName?.touched">
            </ion-input>
          </ion-item>
          <ion-text color="danger" *ngIf="lastName?.invalid && lastName?.touched">
            <small *ngIf="lastName?.errors?.['required']">El apellido es requerido</small>
            <small *ngIf="lastName?.errors?.['minlength']">El apellido debe tener al menos 2 caracteres</small>
          </ion-text>

          <!-- Email -->
          <ion-item>
            <ion-label position="stacked">Email *</ion-label>
            <ion-input 
              type="email" 
              formControlName="email"
              placeholder="tu@email.com"
              [class.ion-invalid]="email?.invalid && email?.touched">
            </ion-input>
          </ion-item>
          <ion-text color="danger" *ngIf="email?.invalid && email?.touched">
            <small *ngIf="email?.errors?.['required']">El email es requerido</small>
            <small *ngIf="email?.errors?.['email']">Ingresa un email válido</small>
          </ion-text>

          <!-- Teléfono -->
          <ion-item>
            <ion-label position="stacked">Teléfono (opcional)</ion-label>
            <ion-input 
              type="tel" 
              formControlName="phone"
              placeholder="+1 (555) 123-4567">
            </ion-input>
          </ion-item>

          <!-- Contraseña -->
          <ion-item>
            <ion-label position="stacked">Contraseña *</ion-label>
            <ion-input 
              type="password" 
              formControlName="password"
              placeholder="Mínimo 6 caracteres"
              [class.ion-invalid]="password?.invalid && password?.touched">
            </ion-input>
          </ion-item>
          <ion-text color="danger" *ngIf="password?.invalid && password?.touched">
            <small *ngIf="password?.errors?.['required']">La contraseña es requerida</small>
            <small *ngIf="password?.errors?.['minlength']">La contraseña debe tener al menos 6 caracteres</small>
          </ion-text>

          <!-- Confirmar Contraseña -->
          <ion-item>
            <ion-label position="stacked">Confirmar Contraseña *</ion-label>
            <ion-input 
              type="password" 
              formControlName="passwordConfirm"
              placeholder="Repite tu contraseña"
              [class.ion-invalid]="passwordConfirm?.invalid && passwordConfirm?.touched">
            </ion-input>
          </ion-item>
          <ion-text color="danger" *ngIf="passwordConfirm?.invalid && passwordConfirm?.touched">
            <small *ngIf="passwordConfirm?.errors?.['required']">La confirmación de contraseña es requerida</small>
            <small *ngIf="passwordConfirm?.errors?.['passwordMismatch']">Las contraseñas no coinciden</small>
          </ion-text>

          <!-- Botón de Registro -->
          <ion-button 
            expand="block" 
            type="submit" 
            [disabled]="registerForm.invalid || isLoading"
            class="register-button">
            <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
            <span *ngIf="!isLoading">
              <i class="fas fa-user-plus"></i> Crear Cuenta
            </span>
          </ion-button>
        </form>

        <!-- Enlace a Login -->
        <div class="text-center login-link">
          <ion-text>
            ¿Ya tienes una cuenta? 
            <a (click)="goToLogin()" class="login-link-text" style="cursor: pointer;">
              Inicia sesión aquí
            </a>
          </ion-text>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
